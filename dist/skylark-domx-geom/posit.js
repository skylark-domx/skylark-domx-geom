/**
 * skylark-domx-geom - The skylark geom library for dom api extension.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-noder","skylark-domx-styler","./geom"],function(L,P,b,k){"use strict";var D=Math.max,F=Math.abs,M=/left|center|right/,S=/top|center|bottom/,B=/[\+\-]\d+(\.[\d]+)?%?/,I=/^\w+/,o=/%$/;function R(t,e,i){return[parseFloat(t[0])*(o.test(t[0])?e/100:1),parseFloat(t[1])*(o.test(t[1])?i/100:1)]}function X(t,e){return parseInt(b.css(t,e),10)||0}var Y={fit:{left:function(t,e){var i,o=e.within,l=o.isWindow?o.scrollLeft:o.offset.left,o=o.width,n=t.left-e.collisionPosition.marginLeft,s=l-n,f=n+e.collisionWidth-o-l;e.collisionWidth>o?0<s&&f<=0?(i=t.left+s+e.collisionWidth-o-l,t.left+=s-i):t.left=!(0<f&&s<=0)&&f<s?l+o-e.collisionWidth:l:0<s?t.left+=s:0<f?t.left-=f:t.left=D(t.left-n,t.left)},top:function(t,e){var i,o=e.within,o=o.isWindow?o.scrollTop:o.offset.top,l=e.within.height,n=t.top-e.collisionPosition.marginTop,s=o-n,f=n+e.collisionHeight-l-o;e.collisionHeight>l?0<s&&f<=0?(i=t.top+s+e.collisionHeight-l-o,t.top+=s-i):t.top=!(0<f&&s<=0)&&f<s?o+l-e.collisionHeight:o:0<s?t.top+=s:0<f?t.top-=f:t.top=D(t.top-n,t.top)}},flip:{left:function(t,e){var i=e.within,o=i.offset.left+i.scrollLeft,l=i.width,i=i.isWindow?i.scrollLeft:i.offset.left,n=t.left-e.collisionPosition.marginLeft,s=n-i,n=n+e.collisionWidth-l-i,f="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,h="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,r=-2*e.offset[0];s<0?((l=t.left+f+h+r+e.collisionWidth-l-o)<0||l<F(s))&&(t.left+=f+h+r):0<n&&(0<(o=t.left-e.collisionPosition.marginLeft+f+h+r-i)||F(o)<n)&&(t.left+=f+h+r)},top:function(t,e){var i=e.within,o=i.offset.top+i.scrollTop,l=i.height,i=i.isWindow?i.scrollTop:i.offset.top,n=t.top-e.collisionPosition.marginTop,s=n-i,n=n+e.collisionHeight-l-i,f="top"===e.my[1]?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,h="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,r=-2*e.offset[1];s<0?((l=t.top+f+h+r+e.collisionHeight-l-o)<0||l<F(s))&&(t.top+=f+h+r):0<n&&(0<(o=t.top-e.collisionPosition.marginTop+f+h+r-i)||F(o)<n)&&(t.top+=f+h+r)}},flipfit:{left:function(){Y.flip.left.apply(this,arguments),Y.fit.left.apply(this,arguments)},top:function(){Y.flip.top.apply(this,arguments),Y.fit.top.apply(this,arguments)}}};return k.posit=function(t,s){var i,f,h,r,e,c,o,l,n,a,p,g,m,d,w,u,W,y=(s=L.extend({},s)).of,v=(x=s.within,m=x||window,n=P.isWindow(m),g=!!m&&9===m.nodeType,e=!n&&!g,T=k.marginSize(m),{element:m,isWindow:n,isDocument:g,offset:e?k.pagePosition(x):{left:0,top:0},scrollLeft:k.scrollLeft(m),scrollTop:k.scrollTop(m),width:T.width,height:T.height}),x=(g=(n=v).isWindow||n.isDocument?"":b.css(n.element,"overflow-x"),e=n.isWindow||n.isDocument?"":b.css(n.element,"overflow-y"),g="scroll"===g||"auto"===g&&n.width<k.scrollWidth(n.element),{width:"scroll"===e||"auto"===e&&n.height<k.scrollHeight(n.element)?k.scrollbarWidth():0,height:g?k.scrollbarWidth():0}),z=(s.collision||"flip").split(" "),H={},T=9===(m=y).nodeType?{size:size(m),offset:{top:0,left:0}}:P.isWindow(m)?{size:k.size(m),offset:{top:k.scrollTop(m),left:k.scrollLeft(m)}}:m.preventDefault?{size:{width:0,height:0},offset:{top:m.pageY,left:m.pageX}}:{size:k.size(m),offset:k.pagePosition(m)};y.preventDefault&&(s.at="left top"),f=T.size.width,h=T.size.height,r=T.offset,e=L.extend({},r),L.each(["my","at"],function(){var t,e,i=(s[this]||"").split(" ");(i=1===i.length?M.test(i[0])?i.concat(["center"]):S.test(i[0])?["center"].concat(i):["center","center"]:i)[0]=M.test(i[0])?i[0]:"center",i[1]=S.test(i[1])?i[1]:"center",t=B.exec(i[0]),e=B.exec(i[1]),H[this]=[t?t[0]:0,e?e[0]:0],s[this]=[I.exec(i[0])[0],I.exec(i[1])[0]]}),1===z.length&&(z[1]=z[0]),"right"===s.at[0]?e.left+=f:"center"===s.at[0]&&(e.left+=f/2),"bottom"===s.at[1]?e.top+=h:"center"===s.at[1]&&(e.top+=h/2),i=R(H.at,f,h),e.left+=i[0],e.top+=i[1],c=t,n=k.marginSize(c),a=n.width,p=n.height,g=X(c,"marginLeft"),m=X(c,"marginTop"),d=a+g+X(c,"marginRight")+x.width,w=p+m+X(c,"marginBottom")+x.height,u=L.extend({},e),W=R(H.my,n.width,n.height),"right"===s.my[0]?u.left-=a:"center"===s.my[0]&&(u.left-=a/2),"bottom"===s.my[1]?u.top-=p:"center"===s.my[1]&&(u.top-=p/2),u.left+=W[0],u.top+=W[1],o={marginLeft:g,marginTop:m},L.each(["left","top"],function(t,e){Y[z[t]]&&Y[z[t]][e](u,{targetWidth:f,targetHeight:h,elemWidth:a,elemHeight:p,collisionPosition:o,collisionWidth:d,collisionHeight:w,offset:[i[0]+W[0],i[1]+W[1]],my:s.my,at:s.at,within:v,elem:c})}),s.using&&(l=function(t){var e=r.left-u.left,i=e+f-a,o=r.top-u.top,l=o+h-p,n={target:{element:y,left:r.left,top:r.top,width:f,height:h},element:{element:c,left:u.left,top:u.top,width:a,height:p},horizontal:i<0?"left":0<e?"right":"center",vertical:l<0?"top":0<o?"bottom":"middle"};f<a&&F(e+i)<f&&(n.horizontal="center"),h<p&&F(o+l)<h&&(n.vertical="middle"),D(F(e),F(i))>D(F(o),F(l))?n.important="horizontal":n.important="vertical",s.using.call(this,t,n)}),k.pagePosition(c,L.extend(u,{using:l}))}});
//# sourceMappingURL=sourcemaps/posit.js.map
